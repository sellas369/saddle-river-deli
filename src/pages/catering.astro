---
import Menu from '../layouts/Menu.astro';
import { getCollection } from 'astro:content';
import Catering from '../components/Catering.svelte';
import Buffet from '../components/Buffet.svelte';
import { getEntry } from 'astro:content';
import Submenu from '../components/Submenu.svelte';

const catering = (await getCollection('catering'))
  .sort((a, b) => a.data.title.localeCompare(b.data.title))
  .sort((a, b) => {
    if (a.data.weight < b.data.weight) return -1;
    if (a.data.weight > b.data.weight) return 1;
    return 0;
  });

const buffet = await getEntry('buffet', 'buffet');
const menu = await getEntry('pages', 'catering');
const config = await getEntry('config', 'config');

const submenu = catering.map((c) => ({
  title: c.data.title,
  slug: c.slug,
}));
submenu.push({
  title: buffet?.data.title,
  slug: buffet?.slug,
});
---

<Menu title={menu?.data.title} slug={menu.slug}>
  <div slot="preamble" set:html={menu?.rendered.html} />

  <Submenu
    menu={submenu}
    title={{
      title: menu?.data.title,
      slug: menu.slug,
    }}
    submenu={config?.data.submenu}
    slot="menu"
    client:load
  />

  <Fragment>
    {catering.map((c) => <Catering menu={c} />)}
    <Buffet menu={buffet} />
  </Fragment>
</Menu>

<!-- <style>
  :global(.main-content) > :global(section) h2 {
    margin-top: 0;
  }
</style> -->
